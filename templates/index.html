<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0f1117;
    --surface: #161b27;
    --border: #1f2535;
    --border-dark: #2a3348;
    --text: #dde3f0;
    --text-muted: #6b7a99;
    --text-light: #3d4d6a;
    --accent: #4a7cdc;
    --accent-glow: rgba(74, 124, 220, 0.15);
    --user-bg: #1e3a6e;
    --user-text: #dde3f0;
    --bot-bg: #161b27;
    --bot-text: #dde3f0;
    --source-bg: #111622;
  }

  html, body { height: 100%; }

  body {
    font-family: 'DM Sans', sans-serif;
    font-weight: 400;
    background: var(--bg);
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  /* â”€â”€ Top bar â”€â”€ */
  .topbar {
    width: 100%;
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--surface);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .topbar-title {
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.01em;
  }

  .topbar-sub {
    font-size: 12px;
    color: #4a7cdc;
    font-family: 'DM Mono', monospace;
    font-weight: 300;
    opacity: 0.7;
  }

  /* â”€â”€ Upload strip â”€â”€ */
  .upload-bar {
    width: 100%;
    max-width: 680px;
    padding: 16px 0 0;
    animation: fadein 0.4s ease both;
  }

  .upload-inner {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: var(--surface);
    transition: border-color 0.15s;
  }

  .upload-inner:focus-within { border-color: var(--border-dark); }

  .upload-icon {
    font-size: 16px;
    opacity: 0.4;
    flex-shrink: 0;
  }

  .upload-inner input[type="file"] {
    font-family: 'DM Sans', sans-serif;
    font-size: 12.5px;
    color: var(--text-muted);
    flex: 1;
    border: none;
    background: transparent;
    outline: none;
    cursor: pointer;
  }

  .upload-inner input[type="file"]::file-selector-button {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    background: var(--border);
    color: var(--text-muted);
    border: 1px solid var(--border-dark);
    border-radius: 6px;
    padding: 4px 10px;
    cursor: pointer;
    margin-right: 10px;
    transition: background 0.1s;
  }

  .upload-inner input[type="file"]::file-selector-button:hover {
    background: var(--border-dark);
    color: var(--text);
  }

  .btn-upload {
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 7px;
    padding: 7px 16px;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.15s;
    flex-shrink: 0;
  }

  .btn-upload:hover { background: #5a8ce8; opacity: 1; }
  .btn-upload:disabled { opacity: 0.35; cursor: not-allowed; }

  .upload-status {
    font-size: 11.5px;
    font-family: 'DM Mono', monospace;
    font-weight: 300;
    padding: 6px 4px 0;
    min-height: 22px;
    color: var(--text-muted);
    transition: color 0.2s;
  }

  .upload-status.ok  { color: #3d9970; }
  .upload-status.err { color: #c0392b; }

  /* â”€â”€ Chat window â”€â”€ */
  .chat-wrap {
    width: 100%;
    max-width: 680px;
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px 0 0;
    animation: fadein 0.4s 0.05s ease both;
  }

  .chat-box {
    flex: 1;
    min-height: 320px;
    max-height: calc(100vh - 260px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-bottom: 8px;
    scroll-behavior: smooth;
  }

  .chat-box::-webkit-scrollbar { width: 4px; }
  .chat-box::-webkit-scrollbar-thumb { background: var(--border-dark); border-radius: 99px; }

  /* â”€â”€ Messages â”€â”€ */
  .msg-row {
    display: flex;
    animation: msg-in 0.22s ease both;
  }

  @keyframes msg-in {
    from { opacity: 0; transform: translateY(5px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .msg-row.user { justify-content: flex-end; }
  .msg-row.bot  { justify-content: flex-start; }

  .bubble {
    max-width: 78%;
    padding: 10px 14px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.65;
    word-break: break-word;
  }

  .msg-row.user .bubble {
    background: var(--user-bg);
    color: var(--user-text);
    border-bottom-right-radius: 4px;
    border: 1px solid rgba(74, 124, 220, 0.25);
  }

  .msg-row.bot .bubble {
    background: var(--bot-bg);
    color: var(--bot-text);
    border-bottom-left-radius: 4px;
    border: 1px solid var(--border);
  }

  .msg-row.bot .bubble.thinking {
    color: var(--text-muted);
    font-style: italic;
    font-size: 13px;
  }

  /* Sources */
  .sources-chip {
    font-family: 'DM Mono', monospace;
    font-size: 10.5px;
    font-weight: 300;
    color: var(--text-muted);
    margin-top: 4px;
    padding: 5px 10px;
    background: var(--source-bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    max-width: 78%;
    word-break: break-word;
    line-height: 1.6;
  }

  /* â”€â”€ Input bar â”€â”€ */
  .input-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 14px 0 24px;
    margin-top: 8px;
    border-top: 1px solid var(--border);
  }

  .input-bar input {
    flex: 1;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    color: var(--text);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.15s;
  }

  .input-bar input::placeholder { color: var(--text-light); }
  .input-bar input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }

  .btn-send {
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    cursor: pointer;
    flex-shrink: 0;
    transition: background 0.15s;
  }

  .btn-send:hover { background: #5a8ce8; }
  .btn-send:disabled { opacity: 0.3; cursor: not-allowed; }

  /* Empty state */
  .empty-state {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 40px 0;
    pointer-events: none;
    user-select: none;
  }

  .empty-state .em-icon { font-size: 28px; opacity: 0.18; }

  .empty-state p {
    font-size: 13px;
    color: var(--text-light);
    font-weight: 300;
  }

  @keyframes fadein {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div class="topbar">
  <span class="topbar-title">PDF Chatbot</span>
  <span class="topbar-sub">RAG Â· project</span>
</div>

<div class="upload-bar">
  <div class="upload-inner">
    <input type="file" id="fileInput" accept=".pdf">
    <button class="btn-upload" id="uploadBtn" onclick="uploadPDF()">Upload</button>
  </div>
  <div class="upload-status" id="uploadStatus"></div>
</div>

<div class="chat-wrap">
  <div class="chat-box" id="chatBox">
    <div class="empty-state" id="emptyState">
      <span class="em-icon">ðŸ’¬</span>
      <p>Upload a PDF, then ask anything about it.</p>
    </div>
  </div>

  <div class="input-bar">
    <input type="text" id="questionInput" placeholder="Ask something about your PDFâ€¦">
    <button class="btn-send" id="sendBtn" onclick="askQuestion()">Send</button>
  </div>
</div>

<script>
  async function uploadPDF() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) { alert('Select a file first.'); return; }

    const btn = document.getElementById('uploadBtn');
    btn.disabled = true;
    setStatus('Uploadingâ€¦', '');

    try {
      const fd = new FormData();
      fd.append('file', file);
      const res = await fetch('/upload', { method: 'POST', body: fd });
      const data = await res.json();
      if (data.error) setStatus(data.error, 'err');
      else setStatus('âœ“ ' + data.message, 'ok');
    } catch {
      setStatus('Upload failed.', 'err');
    } finally {
      btn.disabled = false;
    }
  }

  function setStatus(msg, cls) {
    const el = document.getElementById('uploadStatus');
    el.textContent = msg;
    el.className = 'upload-status ' + cls;
  }

  function addMessage(text, role, sources = null) {
    const box = document.getElementById('chatBox');
    const empty = document.getElementById('emptyState');
    if (empty) empty.remove();

    const row = document.createElement('div');
    row.className = `msg-row ${role}`;
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = text;
    row.appendChild(bubble);
    box.appendChild(row);

    if (sources && sources.length > 0) {
      const chip = document.createElement('div');
      chip.className = 'sources-chip';
      chip.textContent = 'Sources: ' + sources.join(' Â· ');
      box.appendChild(chip);
    }

    box.scrollTop = box.scrollHeight;
    return bubble;
  }

  async function askQuestion() {
    const input = document.getElementById('questionInput');
    const question = input.value.trim();
    if (!question) return;

    addMessage(question, 'user');
    input.value = '';

    const box = document.getElementById('chatBox');
    const thinkRow = document.createElement('div');
    thinkRow.className = 'msg-row bot';
    const thinkBubble = document.createElement('div');
    thinkBubble.className = 'bubble thinking';
    thinkBubble.textContent = 'Thinkingâ€¦';
    thinkRow.appendChild(thinkBubble);
    box.appendChild(thinkRow);
    box.scrollTop = 9999;

    const sendBtn = document.getElementById('sendBtn');
    sendBtn.disabled = true;

    try {
      const res = await fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
      });
      const data = await res.json();
      thinkRow.remove();

      if (data.error) addMessage(data.error, 'bot');
      else addMessage(data.answer, 'bot', data.sources);
    } catch {
      thinkRow.remove();
      addMessage('Something went wrong. Is the server running?', 'bot');
    } finally {
      sendBtn.disabled = false;
    }
  }

  document.getElementById('questionInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') askQuestion();
  });
</script>

</body>
</html>